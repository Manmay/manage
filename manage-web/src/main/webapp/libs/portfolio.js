!function(a,b,c){function f(c,d){this.elem=c,this.$elem=a(c),this.options=a.extend({},e,d),this._defaults=e,this.$overlay=a(this.options.overlay),this.$cats=a(this.options.categories),this.$itemList=a(this.options.itemList),this.$itemDetails=a(this.options.itemDetails),this.$sectionContainer=a(this.options.sectionContainer),this.currentListHtml="",this.currentDetailsHtml="",this.$win=a(b),this.$body=a("body"),this.init()}var e=(b.document,{overlay:"#portfolio .loading-indicator",categories:"ul.categories",itemList:"ul.ajax-portfolio-item-list",itemDetails:"article.ajax-portfolio-item-details",portfolioSliderID:"portfolio-slider",sectionContainer:".section-container",fixedSectionClass:"fixed",itemDetailsImgsForSlider:"ul.images-for-slider",itemDetailsVideoIframe:"iframe.video-iframe",itemDetailsDescription:".desc",itemDetailsDescriptionContentColumn:".content-col",itemDetailsDescriptionDropCapClass:"drop-cap",heightToWidthRatio:.75,minThumbnailWidth:220,itemDetailsDropCap:!0,animationDuration:300,autoScroll:!0});f.prototype.init=function(){var b=this;this.$cats.find("a").on("click",function(c){c.preventDefault(),b.getList(a(this).data("cat"),this)}),setTimeout(function(){b.$cats.find("a").eq(0).trigger("click")},500),this.$win.on("resize",function(){b.refreshHeight()})},f.prototype.resolvePaths=function(b,d){return b.find("a").add(b.filter("a")).each(function(b,e){var f=a(e);f.data("href")!==c&&""!==f.data("href")&&f.attr("href",URL.resolve(d,f.data("href")))}),b.find("img, iframe").add(b.filter("img, iframe")).each(function(b,e){var f=a(e);f.data("src")!==c&&""!==f.data("src")&&f.attr("src",URL.resolve(d,f.data("src")))}),b},f.prototype.getList=function(b,c){var d=this,e=a(c);this.$overlay.addClass("loading"),this.currentListHtml="portfolio/"+b+"/list.html",a.ajax({url:this.currentListHtml,type:"GET",dataType:"html"}).done(function(b){var c=d.resolvePaths(a(b).filter("ul").find("li"),d.currentListHtml);c.find("img").each(function(b,c){var d=a(c);d.parent().css({backgroundImage:'url("'+d.attr("src")+'")'}),d.hide()}),c.find("a").on("click",{self:d},d.thumbnailsOnClick),d.$itemList.html(c),d.$overlay.removeClass("loading"),d.$cats.find("a").removeClass("current"),e.addClass("current"),d.fadeInItemList()}).fail(function(){console.log("unable to load portfolio items"),d.$overlay.removeClass("loading")})},f.prototype.thumbnailsOnClick=function(b){var c=b.data.self,d=a(this),e=a(b.target),f="";b.preventDefault(),f="A"===e.prop("tagName").toLowerCase()?e.attr("href"):e.parents("a").attr("href"),c.retrieveDetails(f,d)},f.prototype.retrieveDetails=function(b,c){var d=this;this.$cats.find("a.current").prop("hash").replace("#",""),this.$overlay.addClass("loading"),this.currentDetailsHtml=b,a.ajax({url:this.currentDetailsHtml,type:"get",dataType:"html"}).done(function(b){var e=d.resolvePaths(a(b),d.currentDetailsHtml),f=d.createNav(c.parents("li")),g=e.filter("h3"),h=e.filter(d.options.itemDetailsImgsForSlider).find("li"),i=d.createSlider(h),j=e.filter(d.options.itemDetailsVideoIframe);$desc=e.filter(d.options.itemDetailsDescription),$backToTop=d.createBackToTop(),d.$itemDetails.html(""),g.appendTo(d.$itemDetails),f.appendTo(d.$itemDetails),i&&i.carousel().appendTo(d.$itemDetails),j.appendTo(d.$itemDetails),d.options.itemDetailsDropCap===!0&&$desc.find(d.options.itemDetailsDescriptionContentColumn+" p:first-child").addClass(d.options.itemDetailsDescriptionDropCapClass),$desc.appendTo(d.$itemDetails),$backToTop.appendTo(d.$itemDetails),d.$overlay.removeClass("loading"),d.fadeOutItemList()}).fail(function(){console.log("error"),d.$overlay.removeClass("loading")})},f.prototype.fadeOutItemList=function(a){var b=this;this.$itemList.animate({opacity:0},this.options.animationDuration,function(){b.$itemList.hide(),b.$itemDetails.show().animate({opacity:1},b.options.animationDuration,function(){a!==!1&&b.options.autoScroll===!0&&b.$sectionContainer.animate({scrollTop:b.computeItemDetailsTop()},b.options.animationDuration)})})},f.prototype.fadeInItemList=function(){var a=this;this.refreshHeight(),this.$itemDetails.animate({opacity:0},this.options.animationDuration,function(){a.$itemDetails.hide().html(""),a.$itemList.show().animate({opacity:1},a.options.animationDuration)})},f.prototype.createNav=function(b){var c=this,d=b.prev(),e=b.next(),f=a("<div />").addClass("portfolio-nav clearfix"),g=a("<i />").addClass("fa fa-th");if(a("<a />").html("Back").attr({href:"#","class":"nav-back"}).prepend(g).on("click",function(a){a.preventDefault(),c.fadeInItemList()}).appendTo(f),d.length>0){var i=a("<i />").addClass("fa fa-arrow-left");a("<a />").html("Prev").attr({href:"#","class":"nav-prev"}).prepend(i).on("click",function(a){a.preventDefault(),$prevA=d.find("a"),c.retrieveDetails($prevA.attr("href"),$prevA)}).appendTo(f)}if(e.length>0){var k=a("<i />").addClass("fa fa-arrow-right");a("<a />").html("Next").attr({href:"#","class":"nav-next"}).prepend(k).on("click",function(a){a.preventDefault(),$nextA=e.find("a"),c.retrieveDetails(e.find("a").attr("href"),$nextA)}).appendTo(f)}return f},f.prototype.createBackToTop=function(){var b=this,c=a("<div />").addClass("portfolio-back-to-top"),d=a("<i />").addClass("fa fa-arrow-up");return a("<a />").html("Top").attr({href:"#","class":"nav-top"}).prepend(d).on("click",function(a){a.preventDefault(),b.$sectionContainer.animate({scrollTop:b.computeItemDetailsTop()},b.options.animationDuration)}).appendTo(c),c},f.prototype.computeItemDetailsTop=function(){return this.$elem.position().top-this.$sectionContainer.children().not("."+this.options.fixedSectionClass).eq(0).position().top+this.$itemDetails.position().top-20},f.prototype.createSlider=function(b){if(b&&0===b.length)return!1;var d,c=this;for($indicators=a("<ol />").addClass("carousel-indicators"),d=0;d<b.length;d++){var e=a("<li />").attr({"data-target":"#"+c.options.portfolioSliderID,"data-slide-to":d,"class":0===d?"active":""});e.appendTo($indicators)}return $slides=a("<div />").addClass("carousel-inner"),b.each(function(b,c){var d=a("<div />").addClass("item");0===b&&d.addClass("active"),a(c).children().appendTo(d),d.appendTo($slides)}),$controlLeft=a("<a />").addClass("left carousel-control").prop("href","#"+c.options.portfolioSliderID).attr("data-slide","prev"),$spanLeft=a("<span />").addClass("glyphicon glyphicon-chevron-left").appendTo($controlLeft),$controlRight=a("<a />").addClass("right carousel-control").prop("href","#"+c.options.portfolioSliderID).attr("data-slide","next"),$spanRight=a("<span />").addClass("glyphicon glyphicon-chevron-right").appendTo($controlRight),$slider=a("<div />").prop("id",c.options.portfolioSliderID).addClass("carousel slide").attr("data-ride","carousel"),$slider.append($indicators,$slides,$controlLeft,$controlRight),$slider},f.prototype.refreshHeight=function(){if(this.$itemList!==c){var b=this,d=this.$cats.innerWidth(),e=Math.floor(d/this.options.minThumbnailWidth),f=this.$itemList.find("li");f.css("width",100/e+"%"),f.find("a").each(function(c,f){var g=a(f);g.css({height:Math.round(d/e*b.options.heightToWidthRatio)})})}},a.fn.portfolio=function(b){return this.each(function(){a.data(this,"plugin_portfolio")||a.data(this,"plugin_portfolio",new f(this,b))})}}(jQuery,window);