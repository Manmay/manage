!function(a,b,c,d){function g(e,g){this.elem=e,this.$elem=a(e),this.$parent=this.$elem.parent(),this.options=a.extend({},f,g),this._defaults=f,this.$win=a(c),this.$body=a("body"),this.$sectionContainer=a(this.options.sectionContainer),this.total=0,this.dataset=this.$elem.find("dt").map(function(){var b=a(this);return{item:b.text(),value:parseInt(b.next().text(),10)}}).get();var h;for(h=0;h<this.dataset.length;h++)this.total+=this.dataset[h].value;var i=this;this.colorRange=this.$elem.find("dt").map(function(){var b=a(this),c=b.data("color");return(c===d||""===c)&&(c=i.options.defaultArcFillColor),c}).get(),this.color=b.scale.ordinal().range(this.colorRange),this.svg=null,this.svgWidth=this.$parent.width(),this.svgHeight=this.$parent.width()*this.options.heightToWidthRatio,!isNaN(this.options.maxHeight)&&this.options.maxHeight>0&&this.svgHeight>this.options.maxHeight&&(this.svgHeight=this.options.maxHeight),this.mainGroup=null,this.arc=null,this.arcs=null,this.arcPaths=null,this.arcLabels=null,this.pie=null,this.scrollTopTrigger=this.$elem.parents("section").position().top-this.options.scrollTopOffset,this.hasDrawn=!1,this.refreshProps(),this.checkPropOverride(),this.init()}var f=(c.document,{paddingLeft:150,paddingRight:0,paddingTop:5,paddingBottom:5,labelClassName:"donut-chart-label",labelFontSize:12,labelFontWeight:700,labelFontColor:"#666",labelHeight:12,showLabel:!0,showPercentage:!1,heightToWidthRatio:.5,maxHeight:200,arcInnerRadiusPercent:50,arcOuterRadiusPercent:100,arcStrokeWidth:3,arcStrokeColor:"#ffffff",defaultArcFillColor:"#ffe0ba",animationDuration:200,animationEasing:"linear",scrollTopOffset:200,onScrollAnimation:!0,sectionContainer:".section-container"});g.prototype.checkPropOverride=function(){this.$elem.data("label-font-color")!==d&&(this.options.labelFontColor=this.$elem.data("label-font-color")),this.$elem.data("show-labels")!==d&&(this.options.showLabel=this.$elem.data("show-labels")),this.$elem.data("show-percentage")!==d&&(this.options.showPercentage=this.$elem.data("show-percentage")),this.$elem.data("max-height")!==d&&(this.options.maxHeight=this.$elem.data("max-height")),this.$elem.data("arc-inner-radius-percent")!==d&&(this.options.arcInnerRadiusPercent=this.$elem.data("arc-inner-radius-percent")),this.$elem.data("arc-outer-radius-percent")!==d&&(this.options.arcOuterRadiusPercent=this.$elem.data("arc-outer-radius-percent")),this.$elem.data("arc-stroke-width")!==d&&(this.options.arcStrokeWidth=this.$elem.data("arc-stroke-width")),this.$elem.data("arc-stroke-color")!==d&&(this.options.arcStrokeColor=this.$elem.data("arc-stroke-color"))},g.prototype.init=function(){var a=this;this.$elem.hide(),this.svg=b.select(this.$parent.get(0)).insert("svg","#"+this.$elem.prop("id")),this.mainGroup=this.svg.append("g").attr("transform","translate("+this.cx+", "+this.cy+")"),this.legendGroup=this.svg.append("g").attr("transform","translate(0, 0)"),this.pie=b.layout.pie().sort(null).value(function(a){return a.value}),this.arcs=this.mainGroup.selectAll(".arc").data(this.pie(this.dataset)).enter().append("g").attr("class","arc"),this.arcPaths=this.arcs.append("path").attr({"stroke-width":this.options.arcStrokeWidth,stroke:this.options.arcStrokeColor,fill:function(b){return a.color(b.data.item)}}),this.labels=this.legendGroup.selectAll("text").data(this.pie(this.dataset)).enter().append("text").attr({"font-size":this.options.labelFontSize,"font-weight":this.options.labelFontWeight,fill:this.options.labelFontColor,opacity:0,"class":this.options.labelClassName}),this.rects=this.legendGroup.selectAll("rect").data(this.pie(this.dataset)).enter().append("rect").attr({fill:function(b){return a.color(b.data.item)},opacity:0}),this.resizeCanvas(),this.$win.on("resize",function(){a.hasDrawn&&a.draw(0)}),this.options.onScrollAnimation===!0&&this.$sectionContainer.on("scroll",function(){a.$sectionContainer.scrollTop()>a.scrollTopTrigger&&a.hasDrawn===!1&&(a.draw(a.options.animationDuration),a.hasDrawn=!0)}),this.options.onScrollAnimation===!0?this.$win.on("load",function(){a.$sectionContainer.scrollTop()>a.scrollTopTrigger&&a.hasDrawn===!1&&(a.draw(a.options.animationDuration),a.hasDrawn=!0)}):this.draw(0)},g.prototype.refreshProps=function(){this.svgWidth=this.$parent.width(),this.svgHeight=this.$parent.width()*this.options.heightToWidthRatio,!isNaN(this.options.maxHeight)&&this.options.maxHeight>0&&this.svgHeight>this.options.maxHeight&&(this.svgHeight=this.options.maxHeight),this.svgHeight<6+20*this.dataset.length&&(this.svgHeight=6+20*this.dataset.length),this.rx=(this.svgWidth-this.options.paddingLeft-this.options.paddingRight)/2,this.ry=(this.svgHeight-this.options.paddingTop-this.options.paddingBottom)/2,this.radius=Math.min(this.rx,this.ry),this.cx=this.svgWidth-this.options.paddingRight-this.radius,this.cy=this.options.paddingTop+this.ry},g.prototype.resizeCanvas=function(){this.svg.attr({width:this.svgWidth,height:this.svgHeight})},g.prototype.draw=function(a){var c=this;this.refreshProps(),this.resizeCanvas(),this.mainGroup.attr("transform","translate("+this.cx+", "+this.cy+")"),this.arc=b.svg.arc().outerRadius(this.radius*this.options.arcOuterRadiusPercent/100).innerRadius(this.radius*this.options.arcInnerRadiusPercent/100),this.labels.attr({x:20,y:function(a,b){return 20*(b+1)}}).transition().delay(function(b,c){return c*a}).duration(a).attr({opacity:1}).text(function(a){return c.options.showLabel?a.data.item+(c.options.showPercentage?" ("+Math.round(100*(a.data.value/c.total))+"%)":""):""}),this.rects.attr({x:0,y:function(a,b){return 20*b+6},width:16,height:16}).transition().delay(function(b,c){return c*a}).duration(a).attr({opacity:1}),this.arcPaths.transition().delay(function(b,c){return c*a}).duration(a).ease(this.options.animationEasing).attrTween("d",function(a){var d=b.interpolate(a.startAngle+.1,a.endAngle);return function(b){return a.endAngle=d(b),c.arc(a)}})},a.fn.donutChart=function(b){return this.each(function(){a.data(this,"plugin_donut_chart")||a.data(this,"plugin_donut_chart",new g(this,b))})}}(jQuery,d3,window);